name: Snowflake ML Pipeline via REST API

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  trigger-ml-pipeline:
    runs-on: ubuntu-latest

    env:
      SNOWFLAKE_ACCOUNT: ${{ secrets.SNOWFLAKE_ACCOUNT }}          # e.g. vy23825.central-india.azure
      SNOWFLAKE_USER: ${{ secrets.SNOWFLAKE_USER }}
      SNOWFLAKE_PASSWORD: ${{ secrets.SNOWFLAKE_PASSWORD }}
      SNOWFLAKE_ROLE: ${{ secrets.SNOWFLAKE_ROLE }}
      SNOWFLAKE_WAREHOUSE: ${{ secrets.SNOWFLAKE_WAREHOUSE }}
      SNOWFLAKE_DATABASE: ${{ secrets.SNOWFLAKE_DATABASE }}
      SNOWFLAKE_SCHEMA: ${{ secrets.SNOWFLAKE_SCHEMA }}

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Trigger Snowflake ML Tasks via REST API
        run: |
          echo "Triggering Snowflake ML pipeline through REST API..."

          SNOWFLAKE_HOST="${SNOWFLAKE_ACCOUNT}.snowflakecomputing.com"
          AUTH=$(echo -n "${SNOWFLAKE_USER}:${SNOWFLAKE_PASSWORD}" | base64)

          SQL_QUERY="EXECUTE TASK TASK_1_DATA_INGESTION; EXECUTE TASK TASK_2_FEATURE_ENGINEERING; EXECUTE TASK TASK_3_MODEL_TRAINING; EXECUTE TASK TASK_4_MODEL_EVALUATION;"

          echo "Running tasks using REST API..."

          RESPONSE=$(curl -s -X POST "https://${SNOWFLAKE_HOST}/api/v2/statements" --cacert /etc/ssl/certs/ca-certificates.crt -H "Authorization: Basic ${AUTH}" -H "Content-Type: application/json" -H "Accept
